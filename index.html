<!-- swipe-survey.html  (LONG format to Google Sheet) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Swipe‑Bias Survey</title>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <style>
    :root{font-family:system-ui,Arial,sans-serif}
    html,body{height:100%;margin:0;overflow:hidden;touch-action:pan-x;overscroll-behavior:none}
    body{display:flex;justify-content:center;align-items:center;background:#f9fafb;transition:background-color .25s}
    body.tint-left{background:rgba(239,68,68,.25)}
    body.tint-right{background:rgba(34,197,94,.25)}
    .page{display:none;width:100%;max-width:420px;padding:1.5rem;box-sizing:border-box}
    .active{display:block}
    h1,h2{text-align:center;margin:0 0 .75rem}
    label{display:block;margin:.5rem 0 .25rem}
    input,select{width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:6px;font-size:.95rem}
    .btn{display:block;margin:1.25rem auto 0;padding:.6rem 1.5rem;background:#2563eb;color:#fff;border:none;border-radius:6px;font-size:1rem;cursor:pointer;text-align:center}
    .image-wrapper{position:relative;width:100%;height:420px;margin-top:.5rem;overflow:hidden}
    .image-wrapper img{width:100%;height:100%;object-fit:cover;border-radius:12px;touch-action:none}
    #loadingScreen{display:flex;flex-direction:column;align-items:center;justify-content:center}
    .loader{width:64px;height:64px;border:8px solid #e5e7eb;border-top:8px solid #2563eb;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- 0 ▸ Loading -->
  <div id="page0" class="page active">
    <div class="loader"></div>
    <p id="progressText" style="margin-top:1rem;font-size:.9rem">Loading images…</p>
  </div>

<script>
const IMAGES_PER_CAT = 10;
const TINT_MS = 200;
const THRESH_PX = 80;
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzKHkteb-3CsNFZWe5Vdf9MGyIbFKPssRXq8gC8s3Lcb0t6t798AH_eY2eENmhTekEx/exec';

const pages = [...document.querySelectorAll('.page')];
const show = i => pages.forEach((p, idx) => p.classList.toggle('active', idx === i));
const shuffle = a => { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; };
const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2, 8);

const IMGS = [...Array.from({ length: IMAGES_PER_CAT }, (_, i) => `alopecia${i + 1}.png`),
              ...Array.from({ length: IMAGES_PER_CAT }, (_, i) => `hair${i + 1}.png`)];

let list1 = [], list2 = [], list3 = [], list4 = [];
let idx1 = 0, idx2 = 0, idx3 = 0, idx4 = 0, startT = 0;
const demo = { id: uid(), age: '', sex: '', year: '', fam: '' };
const swipes = [];

function init() {
  demNext.onclick = () => {
    if (!consent.checked) { alert('Consent required'); return; }
    demo.age = age.value.trim(); demo.sex = sex.value; demo.year = year.value;
    if (!demo.age || !demo.sex || !demo.year) { alert('Complete all fields'); return; }
    show(2);
  };
  instNext.onclick = () => show(3);

  p1Begin.onclick = () => startBlock(1, 'I would like to be friends with this person', img1, list1, 4);
  p2Begin.onclick = () => startBlock(2, 'I would like to work with this person', img2, list2, 6);
  p3Begin.onclick = () => startBlock(3, 'I feel sorry for this person', img3, list3, 8);
  p4Begin.onclick = () => startBlock(4, 'I think this person is in control', img4, list4, 10);

  famNext.onclick = () => {
    if (!familiar.value) { alert('Select familiarity'); return; }
    demo.fam = familiar.value;
    upload();
  };
}

// Preload images AFTER init is defined
let loaded = 0;
IMGS.forEach(src => {
  const img = new Image();
  img.onload = img.onerror = () => {
    loaded++;
    progressText.textContent = `Loading ${loaded}/${IMGS.length}`;
    if (loaded === IMGS.length) {
      show(1);
      init();
    }
  };
  img.src = src;
});
</script>
</body>
</html>
